# Github 连接错误

## 问题背景

​	出现这个现象的前提就是我在学习`CS61c`，途中不是用`github`上传作业吗？结果，真就绝了，上一秒还可以，下一秒，就不行了。虽然已经解决了问题，但是我真的不知道为什么会发生这种情况。

## 问题描述

​	bug出现的顺序依次是这样的。首先，我发现我已经不能用`git push `提交文件了，于是开始去`bing`解决，结果就遇到了很多志同道合的朋友啊，全是说什么设置代理了，结果就绝了，我一台新的学生服务器，啥也没干过，哪里有代理。这时候一位大哥，说测试的时候用`ping`，于是好问题就来了，我发现我的报错是超时，好家伙，是github DNS解析出问题了，所以就开始找为啥，有个哥讲的特别好，[奉上链接](https://zhuanlan.zhihu.com/p/165943024)。

## 解决方案

来试试这个，让你访问github飞起[ipaddress.com](https://ipaddress.com/website/github.com)，将这个GitHub.com的IP地址放进HOST记录里，真的就会飞起。访问比挂了梯子还快。

所以需要的就是不让他自己解析，直接指定IP地址不就ok吗？所以这个时候只需要在host文件里追加记录就可以了。然后就可以访问了。但是我觉得如果只是解决了这个问题，那我花了那么长时间搞的东西岂不是屁用没有，所以还是得给他整明白。

## 学到的知识

DNS解析，虽然以前看过很多DNS，大致内容也了解，但这还是第一次真真正正的被坑到。因为网关层有很大一部分IP被阻挡了，所以不会直接访问到。而GitHub只是因为解析问题，也就是域名和IP之间的那些事儿。

访问的流程是浏览器解析---》然后本地解析---》接着是交给DNS服务器解析---》最后访问到对应IP。说到这里我又想到了一件事，之前搞域名的时候，最开始的时候是在国外白嫖的域名，结果发现竟然没有服务器来解析，所以就去白嫖了腾讯云和阿里云的DNS解析服务器，所以就是说域名这个东西，就是给DNS服务器用的。至于DNS服务器的工作原理，就是这样

1. 浏览器缓存：一次请求会首先通过浏览器缓存信息寻找域名映射的IP地址，这也是为什么有时候我们改了本机hosts，需要关闭再打开浏览器才能正常使用，如果找到则返回，没找到则继续到下一级
2. 本机系统缓存：即上文中提到的，通过 hosts 文件来映射域名和IP，在上古时期有很多垃圾软件会悄咪咪的修改系统的 hosts文件，达到 DNS劫持 的目的，即把淘宝域名指向另一个 IP，然后部署一个高仿的淘宝商城，静静等你输入账号，密码，然后凉凉...
3. 本地域名解析服务系统：本地域名系统LDNS一般都是本地区的域名服务器。离你的位置都比较近，Windows系统使用命令ipconfig 就可以查看，在Linux和Mac系统下，直接使用命令 cat /etc/resolv.conf 来查看LDNS服务地址。 LDNS一般都缓存了大部分的域名解析的结果，大部分的解析工作到这里就差不多已经结束了 以下即是所谓的 递归解析
4. 根域名解析：本地域名解析服务系统无法解析时，会向 13根 发起域名解析请求 说明： 所谓的 13根，指的是根域名服务器，是架构因特网所必须的基础设施。根服务器主要用来管理互联网的主目录，由于DNS解析中采用的是UDP协议，仅能传递512字节的有效报文，因此只能构建出A-M 13个根服务器，而真正工作运行肯定不止13台服务器，而是包含很多服务器镜像的
5. 根域名解析服务器返回 gTLD (Generic top-level domain) 给本地解析服务器，即该域名所属的顶级域及其所在的服务器，顶级域名即如：.com .cn等等
6. 本地解析服务器已知顶级域名服务器地址后，发起解析请求
7. 顶级域名解析服务器返回 权限域名服务器 信息给本地解析服务器，权限域名服务器 即如：[http://taobao.com](https://link.zhihu.com/?target=http%3A//taobao.com)
8. 本地解析服务器已知权限域名服务器地址后，发起解析请求
9. 权限域名服务器返回域名对应的IP地址给本地解析服务器
10. 本地解析服务器缓存相关信息，并返回给用户。

另外还了解到一些DNS解析的其他用处，比如做反向代理水平扩展，典型的互联网架构中，可以通过增加web-server来扩充web层的性能，但反向代理nginx仍是整个系统的唯一入口。**如果系统吞吐超过nginx的性能极限**，那么将难以扩容，此时就需要dns-server来配合水平扩展。

即DNS解析服务器有序的把域名解析到不同的网关层，每次DNS解析请求，轮询返回不同的ip，这样就能实现nginx的水平扩展，这个方法叫 “**DNS轮询**”。还有就是**智能DNS**，网络请求交由域名解析服务器来处理，分配到最佳的服务器IP上

例如：请求的源头是电信还是联通等，如果是电信则将解析的IP分流到电信对应的IP上，或者返回距离最近的服务器IP地址。

## 结语

ok，以上就是本文所有内容，就是说发现了一个问题，热爱解决问题，虽然很花时间，但要弄清楚是一件很让人开心的事情。

再接再厉，夯实基础知识，不断扩充上层知识。